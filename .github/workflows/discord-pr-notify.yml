name: Notify Discord on PR

on:
  pull_request:
    types: [opened, reopened]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Rich Embed to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          # ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ë³€ìˆ˜ ì„¤ì •
          REPO="${{ github.repository }}"
          PR_URL="${{ github.event.pull_request.html_url }}"
          PR_TITLE="${{ github.event.pull_request.title }}"
          AUTHOR="${{ github.event.pull_request.user.login }}"
          AVATAR="${{ github.event.pull_request.user.avatar_url }}"

          # JSON í˜ì´ë¡œë“œ ìƒì„± (Python í™œìš©)
          PAYLOAD=$(python3 -c "
          import json
          data = {
              'embeds': [{
                  'title': 'ğŸ”” ìƒˆë¡œìš´ Pull Requestê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤',
                  'url': '$PR_URL',
                  'color': 5814783, # í‘¸ë¥¸ìƒ‰ ê³„ì—´
                  'fields': [
                      {'name': 'Repository', 'value': '$REPO', 'inline': True},
                      {'name': 'Author', 'value': '$AUTHOR', 'inline': True},
                      {'name': 'Title', 'value': '$PR_TITLE', 'inline': False}
                  ],
                  'thumbnail': {'url': '$AVATAR'},
                  'footer': {'text': 'Auth Multi-Module Project CI'}
              }]
          }
          print(json.dumps(data))
          ")

          curl -H "Content-Type: application/json" -X POST -d "$PAYLOAD" "$DISCORD_WEBHOOK_URL"